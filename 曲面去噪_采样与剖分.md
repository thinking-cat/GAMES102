# 曲面去噪

## 噪声
因为在许多情况下，三维模型的获取是通过类似于3D扫描的方式获得的，然而通过这种方式获得的3D曲面会存在许多的**噪声**，也就是曲面本身并不和现实中的物体表面一样有规律或者平滑

![angle_model_noised](./images/angle_model_noised.png)

但什么是噪声呢？可惜数学上对于噪声没有一个严格的定义，但是对于**去噪**，在统计学上，会采用提取函数的主要的形式，或者去除高频的一些信息来实现去噪的。

## 去噪
在数学上，是这样看待噪声的：

$$M=M_0 + \epsilon$$

其中 $M$ 代表了含噪声的曲面， $M_0$ 代表了没有噪声的曲面。也就是说，数学对于噪声的看法就是那个 $\epsilon$ ，也就是在理想的曲面上，加入了一个小的干扰量。

那么对于离散的三角形网格曲面，该等式可以写为：

$$v=v^0+\boldsymbol{\epsilon n}$$

也就是对于离散的网格，噪声就是对于每一个顶点，让其在各自的法线方向上，进行一个小小的位移。那么为了得到没有噪声的网格，就需要做这个等式的操作：

$$v^0=v-\boldsymbol{\epsilon n}$$

其实这个操作在上一章**Laplace算子**那里已经有过了，也就是：

$$P_{new}\leftarrow P_{old}+\lambda L(P_{old})$$

## 双边滤波
![bilateral_filtering](./images/gaussian_filtering.png)

如上图所示，在图像处理上，传统的高斯滤波仅仅考虑了一个图像像素周围的像素对于当前像素的影响，即：

$$I_s^{'}=\sum_p I(p)f(s-p)$$

其中 $s$ 代表了当前高斯滤波器在作用的图像像素， $I_s^{'}$ 是作用经过高斯滤波处理后的像素色彩，等式右边就是一个离散化了的卷积公式。

虽然高斯滤波对于噪声有很好的过滤作用，但是高斯滤波没有考虑像素色彩之间变化的**剧烈程度**，也就是说对于一些图像的边界，简单的使用高斯滤波会导致边界的**模糊**，并没有很好的消除噪声的效果。

如果将图像的变化频率也一并考虑进来，那么这就是双边滤波：

$$I_s^{'}=\frac{1}{k_s}\sum_p I(p)f(s-p)g(I_s-I_p)$$

其中， $\frac{1}{k_s}=\sum_pf(s-p)g(I_s-I_p)$ ，实际上就是一个归一化的操作。

![bilateral_filtering](./images/bilateral_filtering.png)

此外， $g(I_s-I_p)$ 就如图所示，代表了图像中色彩变化的剧烈程度，如果变化的很剧烈，那么可以认为其是一种图像边界，那么在边界的左右应该做不同的考虑，毕竟边界区分了图像的语义信息，不应该混合在一起。

最后， $f$ 的表达式就是一个标准正态分布，而具体的 $g$ 的表达式如下：

$$g(I_s-I_p)=e^{-\frac{|I_s-I_p|}{2\sigma}}$$

那么在曲面上的应用也是同理，首先假设对于每一个顶点我们能够获得它的法线方向，那么就可以通过点法式得到该点（ $p$ ）的切平面：

$$n\cdot(v-p)=0$$

其中 $v$ 为任意平面上的点，有了切平面就可以很方便的得出空间中任意一点到这个切平面的距离了，那么就可以将这个距离当作参数带入 $g(x)$ 中，实现在三角形网格上的双边滤波。